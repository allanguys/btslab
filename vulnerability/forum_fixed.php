<?php include($_SERVER['DOCUMENT_ROOT'].'/btslab/header.php');
include($_SERVER['DOCUMENT_ROOT'].'/btslab/mysqlconnection.php');
?>
<br/>
-----------------------------------------------
<h1>BTS Discussion Forum</h1>
-----------------------------------------------
</br/>
</br/>

<?php
if(isset($_SESSION['isLoggedIn']))
{
	echo "<br/><b><a href='/btslab/myprofile.php?id=".$_SESSION['userid']."'>My Profile</a></b><br/>";
}
else
{
	echo "Welcome Anonymous User<br/><br/>";
}
?>
<h2>Create Post:</h2>
<form action="forum.php" method="POST">
	Title : <input type="text" name="title" value="" size="50"/><br/>
	Message: <br/><textarea name="content" rows="2" cols="50"></textarea>
	<input type="submit" value="Post" name="post"/>
</form>


<br/>


<?php
//insert post
if(isset($_POST['post']))
{
	$content=$_POST['content'];
	$title=$_POST['title'];
	if(isset($_SESSION['isLoggedIn']))
	{
		$user=$_SESSION['username'];
	}
	else
	{
		$user="Anonymous";
	}
	mysqli_query($con,"INSERT into posts(content,title,user) values ('$content','$title','$user')") or die("Failed to post ".mysql_error());
}

// End of If Statement:

echo "<h2>Posts:</h2>";
//List posts
echo "<table>";
$result=mysqli_query($con,"select * from posts") or die(mysqli_error());
if(mysqli_num_rows($result)>0)
{
	while($row=mysqli_fetch_array($result))
	{
		echo "<tr>";
		echo "<td><b><a href='ForumPosts.php?id=".$row['postid']."'>".htmlspecialchars($row['title'],ENT_QUOTES)."</a></b></td>";
		if($row['user']=="Anonymous")
		{
			echo "<td>-  Posted By ".$row['user']."</td>";
		}
		else
		{
			echo "<td>-  Posted By <a href='/btslab/vulnerability/forumUserList.php?username=".$row['user']."'>".$row['user']."</a></td>";
		}
		echo "</tr>";
	}
}
?>
</table>
<?php include($_SERVER['DOCUMENT_ROOT'].'/btslab/footer.php'); ?>

