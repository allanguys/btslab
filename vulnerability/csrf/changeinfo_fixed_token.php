<?php
include($_SERVER['DOCUMENT_ROOT'].'/btslab/lib/loginverify.php');
include($_SERVER['DOCUMENT_ROOT'].'/btslab/header.php');
if(!isset($_POST['change'])) {
	$_SESSION['csrf'] = md5(rand());

	?>

	Enter New information about you:<br/><br/>
	<form action="changeinfo.php" method="post">
		<input type="text" name="info" value=""/>
		<input type="hidden" name="csrf" value="<?php echo $_SESSION['csrf'];?>"/>
		<br/><br/><input type="submit" name="change" value="Change"/>
	</form>
	<br/>
	<?php
}

if(isset($_POST['info'])&&!empty($_POST['info']))
{


	if(empty($_POST['csrf']) || $_POST['csrf'] !== $_SESSION['csrf']){
		echo '有人试图攻击你的帐号，请联系管理员';
		return;
	}
	$info=$_POST['info'];
	$username=$_SESSION['username'];
	include($_SERVER['DOCUMENT_ROOT'].'/btslab/mysqlconnection.php');
	$result=mysqli_query($con,"Update users set about='$info' where username='$username' ") or die(mysqli_error());;
	echo "<b style='color:red'>个人说明已更改</b>";
}

echo "<br/><br/><a href='/btslab/myprofile.php?id=".$_SESSION['userid']."'>返回个人资料页面 &gt;&gt;</a>";
include($_SERVER['DOCUMENT_ROOT'].'/btslab/footer.php'); ?>
<!-- CSRF 1 -->



<script src="/btslab/lib/md5.js"></script>
<script>
	function getCookie(name)
	{
		var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
		if(arr=document.cookie.match(reg))
			return decodeURIComponent(arr[2]);
		else
			return null;
	}

	function CSRFToken() {
		return hex_md5(getCookie('s_key'))
	}
</script>










